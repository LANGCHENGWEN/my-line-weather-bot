# weather_today/uv_station_mapping.py
"""
建立一個「城市名稱」與「中央氣象署紫外線測站 ID」之間的映射表。
主要職責：
1. 定義映射關係：提供一個字典 `UV_STATION_MAPPING`，將台灣各主要縣市與其代表性的紫外線測站 ID 關聯起來。
2. 提供查詢函式：提供一個 `get_uv_station_id` 函式，根據用戶輸入的城市名稱，從映射表中查找並返回對應的測站 ID。
3. 處理別名：處理常見的城市別名，例如將「台中市」對應到「臺中市」的測站 ID。
"""
from utils.text_processing import normalize_city_name

# --- 台灣主要縣市與其代表性紫外線測站 ID 的映射表 ---
# 這些 StationID 來自中央氣象署 O-A0005-001 紫外線指數 API
UV_STATION_MAPPING = {
    # 北部地區
    "基隆市" : "C0B180", # 基隆
    "臺北市" : "466920", # 臺北氣象站
    "台北市" : "466920", # 兼容別名
    "新北市" : "C0AC60", # 板橋
    "桃園市" : "C0BC00", # 桃園
    "新竹市" : "467571", # 新竹氣象站
    "新竹縣" : "C0D660", # 竹北
    
    # 中部地區
    "苗栗縣" : "C0E640", # 苗栗
    "臺中市" : "467490", # 臺中氣象站
    "台中市" : "467490", # 兼容別名
    "彰化縣" : "C0F9A0", # 彰化
    "南投縣" : "467650", # 日月潭氣象站
    "雲林縣" : "C0N180", # 斗六
    "嘉義市" : "467480", # 嘉義氣象站
    "嘉義縣" : "467480", # 嘉義縣通常也會使用嘉義市的氣象站，或選擇阿里山測站
    
    # 南部地區
    "臺南市" : "467410", # 臺南氣象站
    "台南市" : "467410", # 兼容別名
    "高雄市" : "467440", # 高雄氣象站
    "屏東縣" : "467590", # 恆春氣象站
    
    # 東部地區
    "宜蘭縣" : "C0U730", # 宜蘭
    "花蓮縣" : "C0U9C0", # 花蓮
    "臺東縣" : "C0V320", # 臺東
    "台東縣" : "C0V320", # 兼容別名
    
    # 離島地區
    "澎湖縣" : "467350", # 澎湖氣象站
    "金門縣" : "467110", # 金門氣象站
    "連江縣" : "467990"  # 馬祖氣象站
}

# --- 根據城市名稱獲取對應的紫外線測站 ID ---
def get_uv_station_id(city_name: str) -> str | None:
    """
    嘗試精確匹配用戶輸入的城市名稱。
    如果失敗，則會對城市名稱進行標準化處理，再次嘗試查找。

    Args:
        city_name (str): 用戶查詢的城市名稱。

    Returns:
        str | None: 對應的測站 ID，如果沒有找到則返回 None。
    """
    # 嘗試精確匹配用戶輸入的城市
    station_id = UV_STATION_MAPPING.get(city_name)

    # 處理標準化後的名稱
    normalized_location_name = normalize_city_name(city_name)
    station_id = UV_STATION_MAPPING.get(normalized_location_name)

    return station_id